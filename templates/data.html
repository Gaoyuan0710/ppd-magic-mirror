{% extends 'layout.html' %} {% block style %}
<style>
#main {
    max-width: 1200px;
    min-width: 1020px;
    margin: 0 auto;
}

#plot1 {
    width: 100%;
    height: 300px;
    background-color: #222 !important;
}

#plot21 {
    width: 100%;
    height: 500px;
    background-color: #222 !important;
}

#plot22 {
    width: 100%;
    height: 225px;
    background-color: #222 !important;
}

#plot23 {
    width: 100%;
    height: 225px;
    background-color: #222 !important;
}

#plot3 {
    width: 100%;
    height: 500px;
    background-color: #222 !important;
    text-align: center;
    position: relative;
}

#plot3 p {
    position: absolute;
    color: #759AA0;
    left: 16px;
    top: 13px;
}

#plot3 span {
    position: absolute;
    left: 14px;
    top: 38px;
    font-size: 14px;
    color: #759AA0;
    display: block;
}

#plot3 span:hover {
    cursor: pointer;
}

#plot3 .foreground path {
    fill: none;
    stroke-opacity: .5;
    stroke-width: 1.5px;
}

#plot3 .foreground path.fade {
    stroke: #000;
    stroke-opacity: .05;
}

#plot3 .brush .extent {
    fill-opacity: .3;
    stroke: #fff;
    shape-rendering: crispEdges;
}

#plot3 .axis line,
#plot3 .axis path {
    fill: none;
    stroke: rgba(240, 240, 240, 0.4);
    shape-rendering: crispEdges;
}

#plot3 .axis .tick text {
    fill-opacity: 0.4;
    fill: #f2f2f2;
    font-size: 12px;
}

#plot41 {
    width: 100%;
    height: 400px;
    background-color: #222 !important;
}

#plot42 {
    width: 100%;
    height: 400px;
    background-color: #222 !important;
}

#params {
    position: absolute;
    left: 0;
    top: 42px;
    z-index: 99;
    width: 100%;
    text-align: center;
}

#params>div {
    display: inline-block;
    text-align: center;
    color: #759AA0;
    font-size: 12px;
    margin-left: 10px;
    margin-right: 10px;
    padding-left: 2px;
    padding-right: 2px;
    border-bottom: 1px solid rgba(240, 240, 240, 0.6);
    transition: color .3s;
    -o-transition: color .3s;
    -ms-transition: color .3s;
    -moz-transition: color .3s;
    -webkit-transition: color .3s;
}

#params>div:hover {
    cursor: pointer;
    color: #f2f2f2;
}

#params p {
    margin-bottom: 3px;
}

#params span {
    margin-left: 5px;
}

#mask {
    position: absolute;
    width: 100%;
    height: 100%;
    background-color: rgba(240, 240, 240, 0.8);
    z-index: 999;
    padding: 40px 60px;
    text-align: center;
    display: none;
}

#mask div {
    display: inline-block;
    padding: 8px 16px;
    color: #333;
    border: 1px solid #555;
    border-radius: 3px;
    margin: 10px;
    font-size: 12px;
    box-shadow: 1px 1px 2px rgba(20, 20, 20, 0.5);
    transition: color, background-color .3s;
    -o-transition: color, background-color .3s;
    -ms-transition: color, background-color .3s;
    -moz-transition: color, background-color .3s;
    -webkit-transition: color, background-color .3s;
}

#mask div:hover {
    color: #fff;
    background-color: #333;
    cursor: pointer;
}
</style>
{% endblock %} {% block body %}
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div style="margin-bottom:30px;">
            <div class="plot-title">当月网贷指数</div>
            <div id="plot1"></div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8">
        <div style="margin-bottom:30px;position:relative;">
            <div class="plot-title">平台地理分布</div>
            <div id="plot21"></div>
            <div style="position:absolute;left:20px;top:35px;color:#f2f2f2;"></div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
        <div style="margin-bottom:23px;">
            <div class="plot-title">当月问题平台类型</div>
            <div id="plot22"></div>
        </div>
        <div style="margin-bottom:30px;">
            <div class="plot-title">当月问题平台地区</div>
            <div id="plot23"></div>
        </div>
    </div>
</div>
<div style="margin-bottom:30px;">
    <div class="plot-title">热门平台历史指数</div>
    <div id="plot3">
        <p></p>
        <span class="fa fa-fw fa-play"></span>
        <svg width="1000px" height="500px">
            <g></g>
        </svg>
    </div>
</div>
<div class="row">
    <div class="col-xs-12 col-sm-5 col-md-5 col-lg-5">
        <div class="plot-title">平台类型历史数据</div>
        <div id="plot41"></div>
    </div>
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-7">
        <div style="position:relative;overflow:hidden;">
            <div class="plot-title">区域分布历史数据</div>
            <div id="params">
                <div id="param1">
                    <p>X<span></span></p>
                </div>
                <div id="param2">
                    <p>Y<span></span></p>
                </div>
                <div id="param3">
                    <p>Size<span></span></p>
                </div>
            </div>
            <div id="mask">
                <div>成交量</div>
                <div>运营平台数量</div>
                <div>当月问题平台数量</div>
                <div>累计问题平台数量</div>
                <div>贷款余额</div>
                <div>综合利率</div>
                <div>平均借款期限</div>
                <div>当月投资人数</div>
                <div>当月借款人数</div>
            </div>
            <div id="plot42"></div>
        </div>
    </div>
</div>
<script>
$(document).ready(function() {
    $('#nav2').addClass('active');

    var platCount = eval({{platCount|safe}});

    var plot1 = echarts.init(document.getElementById('plot1'), 'dark');
    var option = {
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data: ['成交指数', '人气指数', '利率指数'],
            padding: [27, 10, 10, 10],
            selected: {
                '利率指数': false
            },
        },
        calculable: true,
        grid: {
            x: 65,
            x2: 50,
            y: 60,
            y2: 50,
        },
        xAxis: {
            type: 'category',
            data: platCount['index'][0],
            axisTick: {
                show: true
            },
            axisLine: {
                show: true
            },
            axisLabel: {
                margin: 12
            }
        },
        yAxis: [{
            type: 'value',
            axisTick: {
                show: true
            },
            axisLine: {
                show: true
            },
            splitLine: {
                show: false
            }
        }, {
            type: 'value',
            axisTick: {
                show: true
            },
            axisLine: {
                show: true
            },
            splitLine: {
                show: false
            }
        }],
        series: [{
            name: '成交指数',
            type: 'line',
            symbol: 'none',
            smooth: true,
            data: platCount['index'][3]
        }, {
            name: '利率指数',
            yAxisIndex: 1,
            type: 'line',
            symbol: 'none',
            smooth: true,
            data: platCount['index'][1]
        }, {
            name: '人气指数',
            type: 'line',
            symbol: 'none',
            smooth: true,
            data: platCount['index'][2]
        }]
    };
    plot1.setOption(option);

    var plot21 = echarts.init(document.getElementById('plot21'), 'dark');
    setTimeout(function() {
        $('#plot21').next('div').append('<p style="font-size:12px;margin-bottom:2px;">营业平台<span style="font-size:20px;margin-left:10px;color:rgba(84, 148, 191, 0.8);position:relative;top:2px;">' + platCount['map'][0].length + '</span></p>');
        $('#plot21').next('div').append('<p style="font-size:12px;margin-bottom:2px;">停业平台<span style="font-size:20px;margin-left:10px;color:rgba(221, 107, 102, 0.8);position:relative;top:2px;">' + platCount['map'][1].length + '</span></p>');
        $('#plot21').next('div').append('<p style="font-size:12px;margin-bottom:2px;">提现困难<span style="font-size:20px;margin-left:10px;color:rgba(230, 157, 135, 0.8);position:relative;top:2px;">' + platCount['map'][2].length + '</span></p>');
        $('#plot21').next('div').append('<p style="font-size:12px;margin-bottom:2px;">跑路平台<span style="font-size:20px;margin-left:10px;color:rgba(234, 126, 83, 0.8);position:relative;top:2px;">' + platCount['map'][3].length + '</span></p>');
        $('#plot21').next('div').append('<p style="font-size:12px;margin-bottom:2px;">经侦介入<span style="font-size:20px;margin-left:10px;color:rgba(243, 230, 162, 0.8);position:relative;top:2px;">' + platCount['map'][4].length + '</span></p>');
        option = {
            legend: {
                left: 'left',
                bottom: 'bottom',
                padding: [20, 20, 20, 20],
                data: ['营业', '停业', '提现困难', '跑路', '经侦介入'],
            },
            geo: {
                type: 'scatter',
                map: 'china',
                label: {
                    emphasis: {
                        show: true,
                        textStyle: {
                            color: '#f2f2f2'
                        }
                    }
                },
                itemStyle: {
                    normal: {
                        areaColor: '#323c48',
                        borderColor: 'rgba(20,20,20,0.2)'
                    },
                    emphasis: {
                        areaColor: '#2a333d'
                    }
                }
            },
            series: [{
                name: '营业',
                type: 'scatter',
                large: true,
                coordinateSystem: 'geo',
                symbolSize: 2,
                legendHoverLink: false,
                itemStyle: {
                    normal: {
                        shadowBlur: 2,
                        shadowColor: 'rgba(84, 148, 191, 0.8)',
                        color: 'rgba(84, 148, 191, 0.8)'
                    }
                },
                data: platCount['map'][0]
            }, {
                name: '停业',
                type: 'scatter',
                large: true,
                coordinateSystem: 'geo',
                symbolSize: 2,
                legendHoverLink: false,
                itemStyle: {
                    normal: {
                        shadowBlur: 2,
                        shadowColor: 'rgba(221, 107, 102, 0.8)',
                        color: 'rgba(221, 107, 102, 0.8)'
                    }
                },
                data: platCount['map'][1]
            }, {
                name: '提现困难',
                type: 'scatter',
                large: true,
                coordinateSystem: 'geo',
                symbolSize: 2,
                legendHoverLink: false,
                itemStyle: {
                    normal: {
                        shadowBlur: 2,
                        shadowColor: 'rgba(230, 157, 135, 0.8)',
                        color: 'rgba(230, 157, 135, 0.8)'
                    }
                },
                data: platCount['map'][2]
            }, {
                name: '跑路',
                type: 'scatter',
                large: true,
                coordinateSystem: 'geo',
                symbolSize: 2,
                legendHoverLink: false,
                itemStyle: {
                    normal: {
                        shadowBlur: 2,
                        shadowColor: 'rgba(234, 126, 83, 0.8)',
                        color: 'rgba(234, 126, 83, 0.8)'
                    }
                },
                data: platCount['map'][3]
            }, {
                name: '经侦介入',
                type: 'scatter',
                large: true,
                coordinateSystem: 'geo',
                symbolSize: 2,
                legendHoverLink: false,
                itemStyle: {
                    normal: {
                        shadowBlur: 2,
                        shadowColor: 'rgba(243, 230, 162, 0.8)',
                        color: 'rgba(243, 230, 162, 0.8)'
                    }
                },
                data: platCount['map'][4]
            }]
        };
        plot21.setOption(option);
    }, 1200);
    var plot22 = echarts.init(document.getElementById('plot22'), 'dark');
    option = {
        tooltip: {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
        },
        series: [{
            name: '平台类型',
            type: 'pie',
            radius: '55%',
            center: ['50%', '50%'],
            data: [{
                value: 32,
                name: '停业'
            }, {
                value: 31,
                name: '跑路'
            }, {
                value: 10,
                name: '提现困难'
            }, {
                value: 1,
                name: '经侦介入'
            }],
            itemStyle: {
                emphasis: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }]
    };
    plot22.setOption(option);
    var plot23 = echarts.init(document.getElementById('plot23'), 'dark');
    option = {
        tooltip: {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
        },
        series: [{
            name: '平台地区',
            type: 'pie',
            radius: '55%',
            center: ['50%', '50%'],
            data: [{
                value: 13,
                name: '广东'
            }, {
                value: 9,
                name: '北京'
            }, {
                value: 9,
                name: '山东'
            }, {
                value: 9,
                name: '其他'
            }, {
                value: 8,
                name: '上海'
            }, {
                value: 7,
                name: '安徽'
            }, {
                value: 6,
                name: '浙江'
            }, {
                value: 5,
                name: '江苏'
            }, {
                value: 5,
                name: '湖北'
            }, {
                value: 3,
                name: '河北'
            }, {
                value: 0,
                name: '福建'
            }],
            itemStyle: {
                emphasis: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }]
    };
    plot23.setOption(option);

    var plot3_traits = ["rank", "score", "trade", "popularity", "weight", "distribution", "flooding", "opacity"];
    var plot3_names = {
        rank: '排名',
        score: '发展指数',
        trade: '成交',
        popularity: '人气',
        weight: '杠杆',
        distribution: '分散度',
        flooding: '流动性',
        opacity: '透明度'
    };
    var margin = [60, 30, 30, 100];
    var plot3_width = 1000 - margin[1] - margin[3];
    var plot3_height = 500 - margin[0] - margin[2];
    var plot3_x = d3.scale.ordinal().domain(plot3_traits).rangePoints([0, plot3_width]);
    var plot3_y;
    var plot3_y_reverse;
    var plot3_line = d3.svg.line();
    var plot3_axis = d3.svg.axis().orient("left").tickPadding([5]);
    var plot3_foreground;
    var plot3_num = 0;
    var tmp = d3.interpolate(d3.rgb(192, 70, 77), d3.rgb(245, 236, 165));
    var plot3_colors = [];
    var plot3_data = [];
    var platNames = [];
    for (var i = 0; i < 20; i++) {
        plot3_colors.push(tmp(i * 0.04));
    }
    d3.select('#plot3 svg g').attr("transform", "translate(" + margin[3] + "," + margin[0] + ")");
    // add foreground
    d3.select('#plot3 svg g').append("svg:g").attr("class", "foreground");
    // add label
    d3.select('#plot3 svg g').append('svg:g').attr('class', 'label');
    // Add a group element for each trait.
    d3.select('svg g').selectAll(".trait").data(plot3_traits).enter().append("svg:g").attr("class", "trait").attr("transform", function(d) {
        return "translate(" + plot3_x(d) + ")";
    }).call(d3.behavior.drag()
        .origin(function(d) {
            return {
                x: plot3_x(d)
            };
        })
        .on("dragstart", plot3_dragstart)
        .on("drag", plot3_drag)
        .on("dragend", plot3_dragend));
    // Add an axis and title.
    d3.select('#plot3 svg').selectAll('.trait').append("svg:g")
        .attr("class", "axis")
        .append("svg:text")
        .attr("text-anchor", "middle")
        .attr("y", -20)
        .attr("fill", '#f2f2f2')
        .attr("font-size", "12px")
        .text(function(d) {
            return plot3_names[d]
        });
    // Add a brush for each axis.
    $('#plot3 svg .trait .brush').remove();
    d3.select('#plot3 svg').selectAll('.trait').append("svg:g")
        .attr("class", "brush");

    plotRank();

    var rankInterval = setInterval(function() {
        plotRank();
    }, 3000);

    function plotRank() {
        $('#plot3 svg g.foreground path').attr('class', '');

        plot3_data = platCount['rank'][plot3_num];
        $('#plot3 p').text(plot3_data[0].replace('年', '-').replace('月', ''));
        platNames = [];
        for (var i = 0; i < plot3_data[1].length; i++) {
            platNames.push(plot3_data[1][i]['platName']);
        }
        plot3_y = {};
        plot3_y_reverse = {};

        // add a scale and brush for each trait.
        plot3_traits.forEach(function(d) {
            plot3_y[d] = d3.scale.linear().domain(d3.extent(plot3_data[1], function(p) {
                return p[d];
            })).range([plot3_height, 0]);
            plot3_y_reverse[d] = d3.scale.linear().domain(d3.extent(plot3_data[1], function(p) {
                return p[d];
            })).range([0, plot3_height]);

            plot3_y[d].brush = d3.svg.brush().y(plot3_y[d]).on("brush", plot3_brush);
        });
        d3.select('#plot3 svg').selectAll('g.axis').each(function(d) {
            if (d == 'rank') {
                d3.select(this).call(plot3_axis.scale(plot3_y_reverse[d]));
            } else {
                d3.select(this).call(plot3_axis.scale(plot3_y[d]));
            }
        });

        $('#plot3 svg g .label').next('.trait').children('.axis').children('.tick').children('text').hide();

        // Add foreground lines.
        plot3_foreground = d3.select('#plot3 svg g.foreground').selectAll("path").data(platNames, function(d) {
            return d;
        });

        plot3_foreground.transition().duration(800).attr('d', plot3_path).attr("stroke", function(d, i) {
            return plot3_colors[i];
        });

        plot3_foreground.enter().append("svg:path").attr("d", plot3_path).attr("stroke", function(d, i) {
            return plot3_colors[i];
        }).attr('opacity', 0).transition().duration(800).attr('opacity', 1);

        plot3_foreground.exit().transition().duration(800).attr('opacity', 0).remove();

        d3.select("#plot3 svg").selectAll('g.brush').each(function(d) {
            d3.select(this).call(plot3_y[d].brush);
        }).selectAll("rect").attr("x", -8).attr("width", 16);

        // add label text
        var label = d3.select('#plot3 svg g.label').selectAll('text').data(platNames, function(d) {
            return d;
        });
        label.transition().duration(800).attr('transform', function(d, i) {
            var tmp = d.match(/[a-z0-9]/g);
            if (tmp == null) {
                tmp = 0;
            } else {
                tmp = tmp.length;
            }
            var tmp1 = d.match(/[A-Z]/g);
            if (tmp1 == null) {
                tmp1 = 0;
            } else {
                tmp1 = tmp1.length;
            }
            return 'translate(' + (tmp * 5 + tmp1 * 3 - d.length * 12 - 18) + ',' + (i * 21 + 5) + ')';
        }).attr('fill', function(d, i) {
            return plot3_colors[i];
        });
        label.enter().append('svg:text').text(function(d) {
            return d;
        }).attr({
            fill: function(d, i) {
                return plot3_colors[i];
            },
            'fill-opacity': 0,
            'font-size': '12px',
            'font-weight': 'lighter',
            transform: function(d, i) {
                var tmp = d.match(/[a-z0-9]/g);
                if (tmp == null) {
                    tmp = 0;
                } else {
                    tmp = tmp.length;
                }
                var tmp1 = d.match(/[A-Z]/g);
                if (tmp1 == null) {
                    tmp1 = 0;
                } else {
                    tmp1 = tmp1.length;
                }
                return 'translate(' + (tmp * 5 + tmp1 * 3 - d.length * 12 - 18) + ',' + (i * 21 + 26) + ')';
            }
        }).transition().duration(800).attr('transform', function(d, i) {
            var tmp = d.match(/[a-z0-9]/g);
            if (tmp == null) {
                tmp = 0;
            } else {
                tmp = tmp.length;
            }
            var tmp1 = d.match(/[A-Z]/g);
            if (tmp1 == null) {
                tmp1 = 0;
            } else {
                tmp1 = tmp1.length;
            }
            return 'translate(' + (tmp * 5 + tmp1 * 3 - d.length * 12 - 18) + ',' + (i * 21 + 5) + ')';
        }).attr('fill-opacity', 0.8);
        label.exit().transition().duration(800).attr({
            'transform': function(d, i) {
                var tmp = d.match(/[a-z0-9]/g);
                if (tmp == null) {
                    tmp = 0;
                } else {
                    tmp = tmp.length;
                }
                var tmp1 = d.match(/[A-Z]/g);
                if (tmp1 == null) {
                    tmp1 = 0;
                } else {
                    tmp1 = tmp1.length;
                }
                return 'translate(' + (tmp * 5 + tmp1 * 3 - d.length * 12 - 68) + ',' + (i * 21 + 5) + ')';
            },
            'fill-opacity': 0
        }).remove();

        plot3_num = (plot3_num + 1) % 20;
    }

    function plot3_dragstart(d) {
        i = plot3_traits.indexOf(d);
    }

    function plot3_drag(d) {
        // plot3_x.range()[i] = d3.event.x;
        // plot3_traits.sort(function(a, b) {
        //     return plot3_x(a) - plot3_x(b);
        // });
        // d3.select('#plot3 svg').selectAll(".trait").attr("transform", function(d) {
        //     return "translate(" + plot3_x(d) + ")";
        // });
        // plot3_foreground.attr("d", plot3_path);
    }

    function plot3_dragend(d) {
        // plot3_x.domain(plot3_traits).rangePoints([0, plot3_width]);
        // var t = d3.transition().duration(500);
        // t.selectAll(".trait").attr("transform", function(d) {
        //     return "translate(" + plot3_x(d) + ")";
        // });
        // t.selectAll(".foreground path").attr("d", plot3_path);
    }

    function plot3_path(d, i) {
        return plot3_line(plot3_traits.map(function(p) {
            // return [plot3_x(p), plot3_y[p](d[p])];
            return [plot3_x(p), plot3_y[p](plot3_data[1][i][p])];
        }));
    }

    // Handles a brush event, toggling the display of foreground lines.
    function plot3_brush() {
        var actives = plot3_traits.filter(function(p) {
            return !plot3_y[p].brush.empty();
        });
        var extents = actives.map(function(p) {
            return plot3_y[p].brush.extent();
        });
        // plot3_foreground.classed("fade", function(d) {
        //     return !actives.every(function(p, i) {
        //         return extents[i][0] <= d[p] && d[p] <= e xtents[i][1];
        //     });
        // });
        plot3_foreground.classed("fade", function(d, j) {
            return !actives.every(function(p, i) {
                return extents[i][0] <= plot3_data[1][j][p] && plot3_data[1][j][p] <= extents[i][1];
            });
        });
    }

    $('#plot3 span').click(function(event) {
        if ($(this).hasClass('fa-play')) {
            $(this).removeClass('fa-play').addClass('fa-pause');
            clearInterval(rankInterval);
        } else {
            $(this).removeClass('fa-pause').addClass('fa-play');
            plotRank();
            rankInterval = setInterval(function() {
                plotRank();
            }, 3000);
        }
    });

    var plot41 = echarts.init(document.getElementById('plot41'), 'dark');
    option = {
        baseOption: {
            color: ['rgba(84, 148, 191, 1)', 'rgba(221, 107, 102, 0.8)', 'rgba(230, 157, 135, 0.8)', 'rgba(234, 126, 83, 0.8)', 'rgba(243, 230, 162, 0.8)'],
            timeline: {
                axisType: 'category',
                orient: 'vertical',
                autoPlay: true,
                inverse: true,
                playInterval: 3000,
                left: null,
                right: 20,
                top: 40,
                bottom: 25,
                width: 70,
                height: null,
                label: {
                    normal: {
                        textStyle: {
                            color: '#999'
                        }
                    },
                    emphasis: {
                        textStyle: {
                            color: '#eee'
                        }
                    }
                },
                symbol: 'none',
                lineStyle: {
                    color: '#555',
                    width: 1
                },
                checkpointStyle: {
                    color: '#bbb',
                    borderColor: '#777',
                    borderWidth: 2
                },
                controlStyle: {
                    showNextBtn: false,
                    showPrevBtn: false,
                    normal: {
                        color: '#666',
                        borderColor: '#666',
                        borderWidth: 1
                    },
                    emphasis: {
                        color: '#aaa',
                        borderColor: '#aaa',
                        borderWidth: 1
                    }
                },
                data: []
            },
            title: {
                'text': platCount.places.months[0],
                textAlign: 'center',
                left: 70,
                bottom: 20,
                textStyle: {
                    fontSize: 30,
                    color: 'rgba(255, 255, 255, 0.7)'
                }
            },
            tooltip: {
                padding: 5,
                backgroundColor: '#222',
                formatter: function(obj) {
                    var value = obj.value;
                    return value;
                }
            },
            calculable: true,
            tooltip: {},
            legend: {
                data: ['民营', '银行', '上市公司', '国资', '风投'],
                top: 20,
                left: 20,
                width: 200
            },
        },
        options: []
    };
    for (var n = 0; n < platCount.types.months.length; n++) {
        option.baseOption.timeline.data.push(platCount.types.months[n]);
        option.options.push({
            title: {
                'text': platCount.types.months[n]
            },
            radar: {
                indicator: [{
                    name: '成交',
                    max: platCount.types.max[n][1]
                }, {
                    name: '运营平台',
                    max: platCount.types.max[n][2]
                }, {
                    name: '当月问题平台',
                    max: platCount.types.max[n][3]
                }, {
                    name: '累计问题平台',
                    max: platCount.types.max[n][4]
                }, {
                    name: '贷款余额',
                    max: platCount.types.max[n][5]
                }, {
                    name: '综合利率',
                    max: platCount.types.max[n][6]
                }, {
                    name: '平均借款期限',
                    max: platCount.types.max[n][7]
                }, {
                    name: '当月投资人数',
                    max: platCount.types.max[n][8]
                }, {
                    name: '当月借款人数',
                    max: platCount.types.max[n][9]
                }],
                center: ['39%', '50%'],
                radius: '40%',
                splitArea: {
                	show: false
                },
                shape: 'circle',
            	startAngle: 180,
                splitLine: {
                	lineStyle: {
                		color: ['rgba(200, 200, 200, 0.3)']
                	}
                },
                axisLine: {
                	lineStyle: {
                		color: 'rgba(200, 200, 200, 0.3)'
                	}
                }
            },
            series: [{
                name: platCount.types.months[n],
                type: 'radar',
                data: platCount.types.series[n],
                symbol: 'none',
            }],
        });
    }
    plot41.setOption(option);

    var plot42 = echarts.init(document.getElementById('plot42'), 'dark');
    var plot42_mapping = [1, 6, 2];
    var plot42_schema = [{
        name: 'province',
        index: 0,
        text: '区域',
        unit: ''
    }, {
        name: 'amount',
        index: 1,
        text: '成交量',
        unit: '亿元'
    }, {
        name: 'operatePlatNumber',
        index: 2,
        text: '运营平台数量',
        unit: '家'
    }, {
        name: 'problemPlatNumber',
        index: 3,
        text: '当月问题平台数量',
        unit: '家'
    }, {
        name: 'problemPlatNumberTotal',
        index: 4,
        text: '累计问题平台数量',
        unit: '家'
    }, {
        name: 'balanceLoans',
        index: 5,
        text: '贷款余额',
        unit: '亿元'
    }, {
        name: 'incomeRate',
        index: 6,
        text: '综合利率',
        unit: '%'
    }, {
        name: 'loanPeriod',
        index: 7,
        text: '平均借款期限',
        unit: '月'
    }, {
        name: 'bidderNum',
        index: 8,
        text: '当月投资人数',
        unit: '万人'
    }, {
        name: 'borrowerNum',
        index: 9,
        text: '当月借款人数',
        unit: '万人'
    }];

    setParams();

    function setParams() {
        $('#param1 span').text(plot42_schema[plot42_mapping[0]].text);
        $('#param2 span').text(plot42_schema[plot42_mapping[1]].text);
        $('#param3 span').text(plot42_schema[plot42_mapping[2]].text);

        var plot42_data = [];
        for (var i = 0; i < platCount.places.series.length; i++) {
            var tmp = [];
            var tmp_data = platCount.places.series[i];
            for (var j = 0; j < tmp_data.length; j++) {
                tmp.push([tmp_data[j][plot42_mapping[0]], tmp_data[j][plot42_mapping[1]], tmp_data[j][plot42_mapping[2]], tmp_data[j][0]]);
            }
            plot42_data.push(tmp);
        }

        option = {
            baseOption: {
                timeline: {
                    axisType: 'category',
                    orient: 'vertical',
                    autoPlay: true,
                    inverse: true,
                    playInterval: 3000,
                    left: null,
                    right: 20,
                    top: 40,
                    bottom: 25,
                    width: 70,
                    height: null,
                    label: {
                        normal: {
                            textStyle: {
                                color: '#999'
                            }
                        },
                        emphasis: {
                            textStyle: {
                                color: '#eee'
                            }
                        }
                    },
                    symbol: 'none',
                    lineStyle: {
                        color: '#555',
                        width: 1
                    },
                    checkpointStyle: {
                        color: '#bbb',
                        borderColor: '#777',
                        borderWidth: 2
                    },
                    controlStyle: {
                        showNextBtn: false,
                        showPrevBtn: false,
                        normal: {
                            color: '#666',
                            borderColor: '#666',
                            borderWidth: 1
                        },
                        emphasis: {
                            color: '#aaa',
                            borderColor: '#aaa',
                            borderWidth: 1
                        }
                    },
                    data: []
                },
                title: {
                    'text': platCount.places.months[0],
                    textAlign: 'center',
                    right: 60,
                    bottom: 75,
                    textStyle: {
                        fontSize: 30,
                        color: 'rgba(255, 255, 255, 0.7)',
                    }
                },
                tooltip: {
                    padding: 5,
                    backgroundColor: '#222',
                    formatter: function(obj) {
                        var value = obj.value;
                        return plot42_schema[0].text + '：' + value[3] + '<br>' + plot42_schema[plot42_mapping[1]].text + '：' + value[1] + plot42_schema[plot42_mapping[1]].unit + '<br>' + plot42_schema[plot42_mapping[0]].text + '：' + value[0] + plot42_schema[plot42_mapping[0]].unit + '<br>' + plot42_schema[plot42_mapping[2]].text + '：' + value[2] + plot42_schema[plot42_mapping[2]].unit + '<br>';
                    }
                },
                grid: {
                    x: 70,
                    x2: 120,
                    y: 40,
                    y2: 50
                },
                xAxis: {
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisTick: {
                        lineStyle: {
                            color: '#ccc'
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#ccc'
                        }
                    },
                    axisLabel: {
                        formatter: '{value} ' + plot42_schema[plot42_mapping[0]].unit,
                        textStyle: {
                            color: '#ccc'
                        },
                        margin: 12
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLine: {
                        lineStyle: {
                            color: '#ccc'
                        }
                    },
                    axisTick: {
                        lineStyle: {
                            color: '#ccc'
                        }
                    },
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        formatter: '{value} ' + plot42_schema[plot42_mapping[1]].unit,
                        textStyle: {
                            color: '#ccc'
                        },
                        margin: 12
                    }
                },
                visualMap: [{
                    show: false,
                    dimension: 3,
                    categories: platCount.places.places,
                    calculable: true,
                    precision: 0.1,
                    textGap: 30,
                    textStyle: {
                        color: '#ccc'
                    },
                    inRange: {
                        color: ['#bcd3bb', '#e88f70', '#edc1a5', '#9dc5c8', '#e1e8c8', '#7b7c68', '#e5b5b5', '#f0b489', '#928ea8', '#bda29a']
                    }
                }],
                series: [{
                    type: 'scatter',
                    itemStyle: {
                        normal: {
                            opacity: 0.8,
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0,
                            shadowColor: 'rgba(255, 255, 255, 0.5)'
                        }
                    },
                    data: plot42_data[0],
                    symbolSize: function(val) {
                        return 90 * parseFloat(val[2]) / parseFloat(platCount.places.max[plot42_mapping[2]]) + 10;
                    }
                }],
                animationDurationUpdate: 1000,
                animationEasingUpdate: 'quinticInOut'
            },
            options: []
        };

        for (var n = 0; n < platCount.places.months.length; n++) {
            option.baseOption.timeline.data.push(platCount.places.months[n]);
            option.options.push({
                title: {
                    show: true,
                    'text': platCount.places.months[n]
                },
                series: {
                    name: platCount.places.months[n],
                    type: 'scatter',
                    itemStyle: {
                        normal: {
                            opacity: 0.8,
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                    data: plot42_data[n],
                    symbolSize: function(val) {
                        return 90 * parseFloat(val[2]) / parseFloat(platCount.places.max[plot42_mapping[2]]) + 10;
                    }
                }
            });
        }
        plot42.setOption(option);
    }
    var plot42_param = '';
    $('#params>div').click(function(event) {
        plot42_param = $(this).attr('id');
        $('#mask').fadeIn('fast');
    });
    $('#mask div').click(function(event) {
        var tmp = $(this).text();
        for (var i = 0; i < plot42_schema.length; i++) {
            if (plot42_schema[i].text == tmp) {
                if (plot42_param == 'param1') {
                    plot42_mapping[0] = i;
                } else if (plot42_param == 'param2') {
                    plot42_mapping[1] = i;
                } else if (plot42_param == 'param3') {
                    plot42_mapping[2] = i;
                }
                break;
            }
        }
        $('#mask').fadeOut('fast', function() {
            setParams();
        });
    });
});
</script>
{% endblock %}